@model personalised_concierge_m1.Models.Calendar

@{
    ViewData["Title"] = "Index";
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
    <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
    <title>Index</title>
</head>
<body>
    <div class="d-flex">
        <h3>Upcoming trips</h3>
        <button type="button" onclick="datePickerModal()" class="btn btn-info ml-auto">Create a new trip</button>
    </div>
    <br />

    <div class="row">
        @foreach (Calendar calendar in Model.CalendarList)
        {
            var startDate = @calendar.StartDate.ToString("dd MMMM yyyy");
            var endDate = @calendar.EndDate.ToString("dd MMMM yyyy");
            var createdDate = @calendar.CreatedDate.ToString("dd MMMM yyyy");
            <div class="card-group col-4" id="card/@calendar.CalendarId">
                <div class="card" onclick=postId(@calendar.CalendarId)>
                    <div class="img-wrap">
                        <img class="card-img-top" src="~/Images/MBS.jpg" alt="MBS image">
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">Trip in Singapore</h5>
                        <p class="card-text">@startDate - @endDate</p>
                        <p class="card-text">
                            <small class="text-muted">Created At: @createdDate</small>
                            <button type="button" onclick="deleteCalendar(@calendar.CalendarId)" class="btn btn-light float-right shadow-none"><i class="fa fa-trash"></i></button>
                        </p>
                    </div>
                </div>
            </div>
        }
    </div>
</body>

<!-- Modal -->
<div class="modal fade" id="datePickerModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Itinerary Planner</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group col-sm-6">
                        <label for="datepicker">From</label>
                        <input type="date" class="form-control" id="datepicker">
                    </div>

                    <div class="form-group col-sm-6">
                        <label for="datepicker2">To</label>
                        <input type="date" class="form-control" id="datepicker2">
                    </div>
                </div>
                <div class="d-flex justify-content-center">
                    <button type="button" onclick="createItinerary()" class="btn btn-info rounded-pill mt-3">Save</button>
                </div>
            </div>
        </div>
    </div>
</div>
</html>
<script type="text/javascript">
    function createItinerary() {
        var from = document.getElementById("datepicker").value
        var to = document.getElementById("datepicker2").value
        var now = getCurrentDate();
        $.ajax({
            type: "POST",
            url: '@Url.Action("createItinerary", "Calendar")',
            data: {
                createdDate: now,
                startDate: from,
                endDate: to
            },
            dataType: 'json',
            success: function (result) {
                var obj = JSON.parse(result);
                location.reload();
                console.log(obj)
            }
        })
    }

    function postId(id) {
        event.stopPropagation();
            $.ajax({
            type: "POST",
            url: '@Url.Action("postId", "CalendarEvent")',
            data: {
                id: id
            },
            dataType: 'json',
            success: function (result) {
                location.href = "/CalendarEvent/Index";
            }
        })
    }

    function deleteCalendar(id) {
        event.stopPropagation();
            $.ajax({
            type: "POST",
            url: '@Url.Action("deleteCalendar", "Calendar")',
            data: {
                id: id
            },
            dataType: 'json',
            success: function (result) {
                var elementId = "card/" + id
                var element = document.getElementById(elementId);
                element.parentNode.removeChild(element);
            }
        })
    }

    function getCurrentDate() {
        const today = new Date();
        const yyyy = today.getFullYear();
        let mm = today.getMonth() + 1; // Months start at 0!
        let dd = today.getDate();

        if (dd < 10) dd = '0' + dd;
        if (mm < 10) mm = '0' + mm;

        var todayString = dd + '/' + mm + '/' + yyyy;
        return todayString
    }

    function datePickerModal() {
        $("#datePickerModal").modal('show');
    }
</script>
